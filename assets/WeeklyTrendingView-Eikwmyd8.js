import{_ as B,n as N,u as U,r as h,p as z,c as l,q as A,i as P,b as o,g as w,d as a,e as c,w as d,F as W,j as F,f as R,o as n,h as C,v as j,M as E}from"./index-7FuSJdjK.js";const D={class:"trending-page"},G={key:0,class:"loading"},H={key:1,class:"error"},J={key:2,class:"empty-list"},K={key:3,class:"trending-movies"},O={class:"pagination"},Q={__name:"WeeklyTrendingView",props:{page:{type:Number,default:1}},setup(M){const x=M,s=N(),p=U(),g=z(),S=R(),r=h(parseInt(g.query.page)||x.page),T=h(500),I=l(()=>s.loading),_=l(()=>s.error),v=l(()=>s.weeklyTrending||[]),m=l(()=>p.isAuthenticated),y=l(()=>{var e;return(e=p.currentUser)==null?void 0:e.id}),L=e=>!m.value||!s.userMovieList.length?!1:s.userMovieList.some(t=>t.movieId.toString()===e.toString()),u=async()=>{try{await s.getWeeklyTrending(r.value),m.value&&y.value&&await s.getUserMovieList(y.value)}catch(e){console.error("获取热门电影失败:",e)}},V=e=>{r.value=e,S.replace({query:{...g.query,page:e}})};return A(r,()=>{u()}),P(()=>{u()}),(e,t)=>{const b=c("el-skeleton"),k=c("el-button"),f=c("el-empty"),q=c("el-pagination");return n(),o("div",D,[t[3]||(t[3]=w("h1",null,"本周热门电影",-1)),I.value?(n(),o("div",G,[a(b,{rows:20,animated:""})])):_.value?(n(),o("div",H,[a(f,{description:_.value,"image-size":200},{default:d(()=>[a(k,{type:"primary",onClick:u},{default:d(()=>t[1]||(t[1]=[C("重试")])),_:1,__:[1]})]),_:1},8,["description"])])):v.value.length===0?(n(),o("div",J,[a(f,{description:"暂无热门电影数据","image-size":200},{default:d(()=>[a(k,{type:"primary",onClick:u},{default:d(()=>t[2]||(t[2]=[C("刷新")])),_:1,__:[2]})]),_:1})])):(n(),o("div",K,[(n(!0),o(W,null,F(v.value,i=>(n(),j(E,{key:i.id,movie:i,"is-in-list":L(i.id)},null,8,["movie","is-in-list"]))),128))])),w("div",O,[a(q,{"current-page":r.value,"onUpdate:currentPage":t[0]||(t[0]=i=>r.value=i),"page-size":20,layout:"prev, pager, next",total:T.value,onCurrentChange:V},null,8,["current-page","total"])])])}}},Y=B(Q,[["__scopeId","data-v-c4e08d5a"]]);export{Y as default};
