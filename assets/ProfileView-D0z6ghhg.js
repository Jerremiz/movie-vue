import{_ as P,u as R,c as U,r as w,i as $,b as d,d as o,w as r,e as a,E as l,o as c,g as t,h as k,t as _,v as C,F as j,j as q,l as b,m as T}from"./index-7FuSJdjK.js";import{u as W}from"./comment-CbQgWbvR.js";const G={class:"profile-container"},H={class:"profile-content"},J={class:"avatar-section"},K={class:"avatar-container"},O={class:"avatar-upload"},Q={class:"user-info"},X={class:"info-item"},Y={class:"comments-section"},Z={key:0,class:"loading-comments"},ee={key:1,class:"no-comments"},te={class:"comment-card-header"},se={__name:"ProfileView",setup(oe){const v=R(),f=W(),n=U(()=>v.currentUser||{}),m=w(!1),p=w([]),A=U(()=>n.value.avatarUrl?`https://mondaydb.top${n.value.avatarUrl}`:""),x=s=>s?new Date(s).toLocaleString("zh-CN"):"",z=s=>{const e=s.type.startsWith("image/"),i=s.size/1024/1024<2;return e?i?!0:(l.error("图片大小不能超过 2MB!"),!1):(l.error("只能上传图片文件!"),!1)},B=async s=>{try{await b.uploadAvatar(n.value.id,s.file);const i=(await b.getUserInfo(n.value.id)).data;v.updateUserAvatar(i.avatarUrl),l.success("头像上传成功")}catch(e){console.error("头像上传失败:",e),l.error("头像上传失败")}},h=async()=>{if(n.value.id){m.value=!0;try{const s=await f.fetchUserComments(n.value.id);p.value=s}catch(s){console.error("获取评论失败:",s),l.error("获取评论失败")}finally{m.value=!1}}},D=s=>{T.confirm("确认删除该评论?","提示",{type:"warning"}).then(async()=>{try{await f.deleteComment(n.value.id,s.id),h(),l.success("评论已删除")}catch(e){console.error("删除评论失败:",e),l.error("删除评论失败")}}).catch(()=>{})};return $(()=>{h()}),(s,e)=>{const i=a("el-avatar"),I=a("Upload"),M=a("el-icon"),y=a("el-button"),S=a("el-upload"),V=a("el-skeleton"),E=a("el-empty"),g=a("el-card"),N=a("el-timeline-item"),L=a("el-timeline");return c(),d("div",G,[o(g,{class:"profile-card"},{header:r(()=>e[0]||(e[0]=[t("h2",null,"个人信息",-1)])),default:r(()=>[t("div",H,[t("div",J,[t("div",K,[o(i,{size:120,src:A.value},null,8,["src"]),t("div",O,[o(S,{class:"avatar-uploader","show-file-list":!1,"before-upload":z,"http-request":B},{default:r(()=>[o(y,{size:"small",type:"primary"},{default:r(()=>[o(M,null,{default:r(()=>[o(I)]),_:1}),e[1]||(e[1]=k(" 上传头像 "))]),_:1,__:[1]})]),_:1})])])]),t("div",Q,[t("h3",null,_(n.value.username),1),t("div",X,[e[2]||(e[2]=t("span",{class:"label"},"用户ID:",-1)),t("span",null,_(n.value.id),1)])])]),t("div",Y,[e[4]||(e[4]=t("h3",null,"我的评论",-1)),m.value?(c(),d("div",Z,[o(V,{rows:5,animated:""})])):p.value.length===0?(c(),d("div",ee,[o(E,{description:"暂无评论","image-size":100})])):(c(),C(L,{key:2},{default:r(()=>[(c(!0),d(j,null,q(p.value,(u,F)=>(c(),C(N,{key:F,timestamp:x(u.createdAt),placement:"top"},{default:r(()=>[o(g,null,{default:r(()=>[t("div",te,[t("h4",null,_(u.title),1),o(y,{type:"danger",size:"small",icon:"Delete",onClick:ae=>D(u)},{default:r(()=>e[3]||(e[3]=[k(" 删除 ")])),_:2,__:[3]},1032,["onClick"])]),t("p",null,_(u.comment),1)]),_:2},1024)]),_:2},1032,["timestamp"]))),128))]),_:1}))])]),_:1})])}}},le=P(se,[["__scopeId","data-v-bcf2ce7a"]]);export{le as default};
